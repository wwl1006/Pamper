# Pamper项目部署指南

## 环境要求

在开始之前，请确保您的Linux系统已安装以下软件：

- Git
- Docker
- Docker Compose

## 安装步骤

### 1. 克隆项目

```bash
git clone https://github.com/ooyyh/Pamper.git
cd Pamper
```

### 2. 安装Docker（如果未安装）

```bash
# 更新包索引
sudo apt-get update

# 安装必要的包
sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release

# 添加Docker官方GPG密钥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# 设置稳定版仓库
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 更新包索引并安装Docker
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io

# 安装Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 将当前用户添加到docker组（可选，避免每次都需要sudo）
sudo usermod -aG docker $USER
```

### 3. 启动项目

```bash
# 进入项目目录
cd Pamper

# 使用Docker Compose构建并启动服务
sudo docker-compose up --build
```

### 4. 访问应用

- 前端应用：http://localhost
- 后端API：http://localhost/api/
- 数据库：默认端口3306（仅容器内部访问）

### 5. 停止应用

```bash
# 在启动项目的终端中按 Ctrl+C
# 或者使用以下命令
sudo docker-compose down
```

### 6. 查看容器日志

```bash
# 查看所有服务的日志
sudo docker-compose logs

# 查看特定服务的日志（例如后端）
sudo docker-compose logs backend
```

## 项目结构说明

- `Pamper-Front`：Vue.js前端项目
- `src/main/java`：Spring Boot后端代码
- `src/main/resources/application.yml`：应用配置文件
- `Dockerfile`：主Docker构建文件
- `docker-compose.yml`：Docker Compose编排文件
- `nginx.conf`：Nginx配置文件
- `activities`, `adoption`, `avatars`, `pets`, `posts`：文件上传目录

## 故障排除

如果遇到问题，请检查：

1. 确保所有端口（80, 8080, 3306）未被其他服务占用
2. 确保Docker服务正在运行：`sudo systemctl status docker`
3. 确保有足够的磁盘空间
4. 检查容器日志以获取详细错误信息

## 高级配置

如果需要修改数据库配置，可以编辑 `src/main/resources/application.yml` 文件中的数据库连接参数。

如果需要修改前端环境配置，可以编辑 `Pamper-Front/.env` 文件。